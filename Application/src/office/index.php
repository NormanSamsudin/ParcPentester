<!DOCTYPE html>
<!-- //buggy script by Eagle Eye -->
<html>
<head>
<title>Members Area</title>
<style>
html{
    box-sizing:border-box;
    margin:0px;
    padding:0px;
    height:100vh;
}
body {
    padding:10px;
}
a{
    text-decoration:none;
}
.welcome h3{
width:500px;
float:right;
}
.welcome a{
    margin-left:20px;
}
.main{
padding:50px;
width:70%;
height:100%;
margin:auto;
text-align:center;
}
.darkmode{
    background-color:#000;
    color:#fff;
}
</style>

</head>
<?php
session_start();
setrawcookie('style','PRD');
include('../config.php');
function logout()
{
    unset($_SESSION['administrator']);
    unset($_SESSION['SESSION_USER']);
    unset($_SESSION['name']);
    unset($_SESSION['email']);
    unset($_SESSION['userid']);
    session_unset();
    session_destroy();
    echo "<script>window.location.replace('/office/')</script>";
}
function authCheck()
{
    if(!isset($_COOKIE['SESSION_USER']))
    {
        logout();
    }
    else
    {
        if($_COOKIE['SESSION_USER'] != $_SESSION['SESSION_USER'])
        {
            logout();
        }
        else{
            $_SESSION['administrator']==true;
            
        }
        
    }
}
if(!isset($_SESSION['administrator']) || ($_SESSION['administrator']==false))
{
    require_once('login.php');
}
else
{
    authCheck();
    $status = $_SESSION['status'];
    ?>
   <body>
   <section class='welcome'>
   <a href='?action=logout'>Logout</a>
   <?php
   if($status=="Administrator" || $status=="Author")
   {
       echo "<a href='csrf.php'>Add Product</a>";
   }
   ?>
   <a href='profile.php'>Manage profile</a>
   <h3 class='right'>
   <?php
   echo "Hello ".$_SESSION['name']." you are now logged in as ".$status."<br>";
   echo "<button onclick='myFunction()'>Toggle dark mode</button>";
   ?>
   </h3>
   </section>
   <section class='main'>
    <?php 
    if($status=="Administrator" || $status=="Author")
    {
        include('report.php'); 
    }
    else
    {
        include('../contact.php');
    }
    ?>
   </section>
<script>
function myFunction() {
   var element = document.body;
   element.classList.toggle("darkmode");
}
</script>
   </body>
    <?php
    if(isset($_GET['action']) && $_GET['action']=='logout')
    {
        logout();
    }
}
?>
</html>