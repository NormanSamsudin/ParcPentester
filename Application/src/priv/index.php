<?php

session_start();

$header = getallheaders();
$host = "localhost";

if(isset($_SERVER['HTTP_X_FORWARDED_PROTO']))
{
    $protocol = $_SERVER['HTTP_X_FORWARDED_PROTO'];
}
else
{
    $protocol = $_SERVER['REQUEST_SCHEME'];
}

if($_SERVER['HTTP_HOST']=='127.0.0.1' && !isset($_SESSION['loggedIn']))
{
    echo "<script>window.location.replace('".$protocol."://".$host.$_SERVER['SCRIPT_NAME']."');</script>";
}
else if($_SERVER['HTTP_HOST']==$host)
{
    if(!isset($_SESSION['loggedIn']))
    {
        echo "Please login!";
        echo "<form action='' method='post'><table>
              <tr><td>Username  </td><td><input type='text' name='username'></td></tr>
              <tr><td>Password  </td><td><input type='text' name='password'><td></tr>
              <tr><td>  </td><td><input type='submit' name='user_login' value='Login'><td></tr>
              </table></form>";
        if(isset($_POST['user_login']))
        {
            if($_POST['username']=='user' && $_POST['password']=='user')
            {
                $_SESSION['loggedIn']='user';
                echo "<script>alert('Successfully logged in!');setTimeout(function(){ window.location.replace('priv_user.php'); },500)</script>";
            }
        }
    }
    else
    {
        header('Location:priv_user.php');
    }
}
else if($_SERVER['HTTP_HOST']=='127.0.0.1' && isset($_SESSION['loggedIn']))
{
    header('Location:priv_admin.php');
}
else
{
    die("Error!");
}
echo "<pre>";
print_r($_SERVER);
echo "</pre>";
