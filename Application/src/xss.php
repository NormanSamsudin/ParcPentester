<!DOCTYPE html>
<html>
<body>
<head>
  <style>
  *{
    filter: invert(100%);
  }
   body{
    background:#fff;
   }
   form label{
    color:#3ef;
   }
   #strd{
    color:#aeff0e;
   }
  </style>
</head>
<?php
/* Buggy script coded by Eagle Eye */
include('config.php');
function represh()
{
    setrawcookie('xss',null);
    unset($_COOKIE['xss']);
    echo "<script>window.location.replace('xss.php');</script>";
}
if(isset($_POST['choose']))
{
    $type = $_POST['xss_type'];
    switch($type)
    {
        case 'stored':
            setrawcookie('xss','stored');
            header('Location:'.$_SERVER['PHP_SELF']);
        break;
        case 'dom':
            setrawcookie('xss','dom');
            header('Location:'.$_SERVER['PHP_SELF']);
        break;
        case 'reflected':
            setrawcookie('xss','reflected');
            header('Location:'.$_SERVER['PHP_SELF']);
        break;
    }
}

if(!isset($_COOKIE['xss']))
{
    ?>
    <form action="" method="POST">
        <label>Pick XSS Type : </label>
        <select name="xss_type">
            <option value="reflected">Reflected XSS</option>
            <option value="stored">Stored XSS</option>
            <option value="dom">DOM XSS</option>
        </select>
        <input type="submit" value="choose" name="choose">
    </form>
    <?php
}
else{
    setrawcookie('style','OOB');
    switch($_COOKIE['xss'])
    {
        case 'stored':
            setrawcookie('xss_flag','stored_xss');
            echo "<form action='' method='POST'>";
            echo "Product name : <input type='text' name='name'><br>";
            echo "Descriptions : <br><textarea cols='40' rows='10' name='descriptions'></textarea><br>";
            echo "<br><input type='submit' name='submit'>";
            echo "</form>";
            echo "<form action='' method='POST'><input type='submit' name='represh' value='goback'></form>";
            if(isset($_POST['submit']))
            {
            $name = $_POST['name'];//htmlspecialchars($_POST['name']);
            $descriptions = $_POST['descriptions'];//htmlspecialchars($_POST['descriptions']);
            $sql = "INSERT INTO store(name,descriptions) VALUES('$name','$descriptions')";
            $result = $mysqli -> query($sql) or die($mysqli -> error);
              if($result)
              {
                  echo "<h3>New Inserted</h3></br>Product name : ".$name."<br>Descriptions : ".$descriptions;
              }
            }
            if(isset($_POST['represh']))
            {
                represh();
            }
        include('store.php');
        break;
        case 'dom':
            setrawcookie('xss_flag','dom_xss');
            if(isset($_POST['submit']))
            {
                echo '<meta lang="'.htmlspecialchars($_POST['lang'],ENT_QUOTES).'">';
                if($_POST['lang']=='my')
                {
                    echo "<p id=strd>Kamu pilih bahasa malaysia</p>";
                }
                else
                {
                    echo "<p id=strd>You choosed english language</p>";
                }
            }
            else
            {
                echo "<form action='' method='POST'>";
                echo "Select Language : <select name='lang'>";
                echo "<option value='default' selected>Select language</option>";
                echo "<option value='en'>English</option>";
                echo "<option value='my'>Malay</option></select>";
                echo "<input type='submit' name='submit'>";
                echo "</form>";
                echo "<form action='' method='POST'><input type='submit' name='represh' value='goback'></form>";
            }
            if(isset($_POST['represh']))
            {
                represh();
            }
        break;
        case 'reflected':
            setrawcookie('xss_flag','reflect_xss');
            echo "<form action='' method='GET'>";
            echo "Your name : <input type='text' name='nama'><br>";
            echo "<input type='submit' name='submit'>";
            echo "</form>";
            echo "<form action='' method='POST'><input type='submit' name='represh' value='goback'></form>";
            if(isset($_GET['submit']))
            {
                //strip_tags();
                echo "<p id=strd>Hi ". $_GET['nama'] ." Welcome to Basic XSS Tutorial!</p>";
                echo "<br><button onclick=backs()>Back</button>";
                echo "<script>function backs(){ window.location.replace('/xss.php'); }</script>";
            }
            if(isset($_POST['represh']))
            {
                represh();
            }
        break;
    }
}

?>
</body>
</html>