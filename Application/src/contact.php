<?php
setcookie('style','OOB');
function emailValidaion($email)
{
$allowed_mail = array("gmail.com","yahoo.com","protonmail.com");
$disallowed = array("'",")","(","<",">","*","&","^","%",'"',"#","--","!","~");
    $check = explode("@",$email);
    if(isset($check[2]))
    {
        return false;
    }
    else
    {
      if(isset($check[1]))
       {
        foreach($disallowed as $dis)
        {
            if(in_array($check[1],$allowed_mail) && (!strpos($check[0],$dis)))
            {
                return true;
            }
            else
            {
                return false;
            }
        }
       }
       else
       {
           return false;
       }
    }
}
if(!isset($_POST['submit']))
{
  echo "</br></br>";
  echo "<form action='' method='POST' enctype='application/x-www-form-urlencoded'>";
  echo "<label>Enter your email</label>";
  echo "<input type='text' name='email'></br>";
  echo "<textarea rows='30' cols='100' name='message'></textarea>";
  echo "<br><input type='submit' name='submit' value='send'>";
  echo "</form>";
}
else
{
    $email = htmlspecialchars($_POST['email']);
    $message = $_POST['message'];
    if(emailValidaion($email))
    {
        if(strpos($message,"'"))
        {
        $pattern = "/'/i";
        $message = preg_replace($pattern,"~",$message);
        }
                $sql = "INSERT INTO contact(Email,Reports) VALUES('$email','$message')";
                $result = $mysqli -> query($sql) or die("Failed to send reports!");
                echo "<br><br>Message successfully sent!";
                echo "<script>setTimeout(function() { window.history.back(); },1500);</script>";
    }
    else
    {
        error_reporting(0);
        echo "<br><br>Email you entered not valid or contain special chars!";
        echo "<script>setTimeout(function() { window.history.back(); },1000);</script>";
    }
}
?>