<?php
include 'function.php';
$exec = new exec_proc;
$register = $exec -> database($host,$username,$password,$database);
$avatar="avatars/default.png";
$member_id = mt_rand(0,254);
$rq = "SELECT member_id FROM members";
$rf = $register->query($rq);
$rw = $rf->fetch_assoc();
if($rw['member_id']==$member_id)
{
    $member_id = $member_id+mt_rand(5,15);
}
?>
<!DOCTYPE html>
<html>
<head>
 <title>Account Registration</title>
 <script src="js/sweetalert2@10"></script>
</head>
<body>
<center><form action='' method='POST' autocomplete='off' name='registrationForm' onsubmit='validateRegister();'><table>

<tr><td><label>Name <label></td><td><input type='text' name='name' required></td></tr>
<tr><td><label>Gender <label></td>
<td><select name='gender' required>
<option default>Choose your gender</option>
<option value='M'>Male</option>
<option value='F'>Female</option>
<option value='O'>Sajat</option>
</select></td></tr>
<tr><td><label>Email <label></td><td><input type='text' name='email' required></td></tr>
<tr><td><label>Born Year <label></td><td><input type='text' name='bornyear' required></td></tr>
<tr><td><label>Telephone Number <label></td><td><input type='text' name='notel' required></td></tr>
<tr><td><label>IC Number <label></td><td><input type='text' name='icno' required></td></tr>
<tr><td><label>Address Line 1 <label></td><td><input type='text' name='addr1' required></td></tr>
<tr><td><label>Address Line 2 <label></td><td><input type='text' name='addr2' required></td></tr>
<tr><td><label>Address Line 3 <label></td><td><input type='text' name='addr3'></td></tr>
<tr><td><label>Username <label></td><td><input type='text' name='user' required></td></tr>
<tr><td><label>Password <label></td><td><input type='password' name='password1' required></td></tr>
<tr><td><label>Re-Enter Password <label></td><td><input type='password' name='password2' required></td></tr>
<tr><td><label><label></td><td><input type='submit' name='register'></td></tr>
<script>
    function validateRegister()
    {
        if(document.registrationForm.password1.value != document.registrationForm.password2.value)
        {
            Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'Your password entered not matched!',})
            event.preventDefault();
        }
    }
</script>
</table></form></center>
<?php
if(isset($_POST['register']))
{
    if($_POST['password1']!=$_POST['password2'])
    {
        echo "<script>alert('Password not matched!');</script>";
    }
    else
    {
        $user=$_POST['user'];
        $pass=sha1($_POST['password1']);
        $icno=$_POST['icno'];
        $email=$_POST['email'];
        $gender=$_POST['gender'];
        $bornyear=$_POST['bornyear'];
        $address=$_POST['addr1']." ".$_POST['addr2']." ".$_POST['addr3'];
        $notel=$_POST['notel'];
        $name=$_POST['name'];

        $exec->register($register,$user,$pass,$icno,$email,$gender,$bornyear,$address,$notel,$name,$avatar,$member_id);
    }
}
?>
</body>
</html>