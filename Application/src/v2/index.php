<!DOCTYPE html>
</html>
<head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
   <?php if(isset($_COOKIE['stylesheet'])) include($_COOKIE['stylesheet']); ?>
<script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="js/sweetalert2@10"></script>
<script>
  function sureLogout()
  {
      let x = confirm('Are you sure to logout?');
      if(x==true)
      {
        window.location.replace('?action=logout');
      }
  }
</script>
</head>
<body>
<?php
include('function.php');
include('constant/define1.php');
include('constant/define2.php');
$exec = new exec_proc;
$mysqli = $exec -> database($host,$username,$password,$database);

if(!isset($_SESSION['members']))
{
    header('Location:login.php');
}
else
{
    $id = $_SESSION['id'];
    $query = "SELECT * FROM members WHERE id='$id'";
    $fetch = $mysqli->query($query);
    $data = $fetch -> fetch_assoc();
    echo "<title>Dashboard</title>";
    echo "<section class='mainmenu'>";
    echo "Welcome back <a href='index.php'>".strip_tags($data['name'])."</a>";
    echo "<a id='navbar' href='#' onclick='sureLogout();'>logout</a>";
    echo "<a id='navbar' href='?action=chgpass'>Change Password</a>";
    echo "<a id='navbar' href='?action=loadTxt'>My files</a>";
    echo "<a id='navbar' href='?action=privacy'>Privacy</a>";
    echo "<a id='navbar' href='profile.php'>Discover</a>";
    echo "<a id='navbar' href='?action=view'>Status</a>";
    echo "<a id='navbar' href='post.php'>Post</a>";
    echo "</section>";
    if(isset($_GET['action']))
    {
        $act = $_GET['action'];
        switch($act)
        {
            case 'logout':
                $exec->logout();
            break;
            case 'privacy':
                echo "<section class='$act'>";
                $exec->privacy_control($id,$mysqli);
                include('deactivate.php');
                ?><center>
                <form action='' method='POST' onsubmit='return confirm("Do you really want to deactivate?");'>
                <input type='submit' name='deactivate' value='Deactivate Account' style='margin-top:10px;cursor:pointer;'>
                </form></section></center>
                <?php
            break;
            case 'view':
                echo "<center><section class='$act'>";
                if(!isset($_GET['get']))
                {
                    $query1 = "SELECT member_id FROM status ORDER BY id DESC";
                    $result1 = $mysqli->query($query1);
                    while($row1 = $result1->fetch_assoc())
                    {
                        echo "<a href='?action=view&get=status&sid=".$row1['member_id']."&res=200'>Link</a>";
                    }
                    
                }
                else
                {
                    if($_GET['res']==200)
                    {
                        $fail = $_GET['get'].".php";
                        $path = pathinfo($fail);
                        if(file_exists($path['basename']))
                        {
                           include($path['basename']);
                        }
                    }
                    else
                    {
                        $error = $_GET['res'];
                        $readerror = file_get_contents("http://127.0.0.1/v2/error_handler.php?err=code&no=$error");
                        $errdec = json_decode($readerror) or die($readerror);
                        echo "<script>alert('".$errdec->$error."');</script>";
                    }
                    
                }
                echo "</section></center>";
            break;
            case 'chgpass':
                echo "<center>";
                include('change_pass.php');
                echo "</center>";
            break;
            case 'loadTxt':
                require_once 'loadfile.php';
            break;
            default:
            echo "<section class='$act'><center>";
            echo "Nothing here";
            echo "</center></section>";
            break;
        }
    }
    else
    {
        $mid = htmlentities($data['member_id']);
        $avatar = htmlentities($data['avatar']);
        $name = htmlspecialchars($data['name']);
        $email = htmlspecialchars($data['email']);
        $gender = htmlspecialchars($data['gender']);
        $noic = htmlspecialchars($data['icno']);
        $notel = htmlspecialchars($data['notel']);
        $born = htmlspecialchars($data['bornyear']);
        $addr = htmlspecialchars($data['address']);

        if($gender=='M')
        {
            $gender1 = 'Male';
        }
        else if($gender=='F')
        {
            $gender1 = 'Female';
        }
        else
        {
            $gender1 = 'Pondan';
        }
        echo "<center><img src='photo.php?pid=".$mid."' width='200px' height='200px'><table>";
        echo "<form action='update_profile.php' method='POST'>";
        echo "<tr><td>Member </td><td>: ".$mid."</td></tr>";
        echo "<tr><td>Name </td><td>: ".$name."</td></tr>";
        echo "<tr><td>IC </td><td>: ".$noic."</td></tr>";
        echo "<tr><td>Email </td><td>: ".$email."</td></tr>";
        echo "<tr><td>Gender </td><td>: ".$gender1."</td></tr>";
        echo "<tr><td>No Tel </td><td>: ".$notel."</td></tr>";
        echo "<tr><td>Born Year </td><td>: ".$born."</td></tr>";
        echo "<tr><td>Address </td><td>: ".$addr."</td></tr>";
        echo "<tr><td><input type='hidden' value='".$mid."' name='id'><input type='hidden' value='".$_SESSION['user_session']."' name='usr_sess'></td>";
        echo "<td> <input type='submit' value='Edit Profile'></td></tr>";
        echo "</form></center></table>";
    }
}
?>
<!--
<script>
function loadXMLDoc() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      document.getElementById("main_page").innerHTML =
      this.responseText;
    }
  };
  xhttp.open("GET", "main_page.php", true);
  xhttp.send();
}
<script>
setInterval(function(){
	loadXMLDoc();
	// 1sec
},1000);

window.onload = loadXMLDoc;
</script> -->
<section id='admin_area'>
<div class='text-footer'>
<pre>Note <a href='administrator.php'>this</a>is only accessible by admin</pre>
</div>
</section>
</body>
</html>