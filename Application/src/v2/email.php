<?php

define("_EMAIL_",$_SERVER['SERVER_ADMIN']);
ini_set('smtp_port',587);
ini_set("SMTP","smtp.gmail.com");
ini_set("webmaster@eagle-tube.com",_EMAIL_);

$scriptname = pathinfo($_SERVER['SCRIPT_NAME']);
$directory = $scriptname['dirname'];
$current_url = $_SERVER['REQUEST_SCHEME'] . "://" . $_SERVER['HTTP_HOST'] . $directory;

libxml_disable_entity_loader(false);
$xm = file_get_contents('php://input');
if(isset($xm) && $xm!="")
{
    $dom = new DOMDocument();
    $dom->loadXML($xm,LIBXML_NOENT | LIBXML_DTDLOAD);
    $register = simplexml_import_dom($dom);
    $email = $register->email;
    $name = $register->name;
    $user = $register->user;
    $pass = $register->pass;
    $token = $register->token;
    if((isset($email) && isset($token)) && ($email!="" && $token!=""))
    {
        $subject = "Account activation!";
        $message = "<!DOCTYPE html><html>
                    <body style='background:url(http://avante.biz/wp-content/uploads/Background-Pics-HD/Background-Pics-HD-001.jpg);
                    background-repeat:no-repeat;color:#fff;padding:10px;box-sizing:border-box;'>
                    <center><h2>Hi $name thank you for registering account!</h3></br>
                    <h3>Here your login user and password details : </h2><table><tr>
                    <td><p>Username </td><td>:</td><td> $user</td></tr>
                    <td>Password </td><td>:</td><td> (MD5 Hash)$pass</td></p>
                    </table></tr></center>
                    <br><div style='text-align:center;width:80%;margin:auto;'>
                    <p>And please Activate your account from the link below</p>
                    <button style='padding:5px;background:red;border:none;'>
                    <a style='text-decoration:none;font-size:18px;color:#000' href='$current_url/activation.php?email=$email&token=$token'>
                    Account Activation</a></button>
                    </div></body></html>";
        
                 $headers = "From: Eagle Tube Officials\r\n";
                 $headers  = 'MIME-Version: 1.0' . "\r\n";
                 $headers .= 'Content-type: text/html; charset=iso-8859-1' . "\r\n";
        
                if(mail($email,$subject,$message,$headers))
                {
                    echo "<script>
                    Swal.fire({
                        title: '<strong>Your new account successfully registered</strong>',
                        icon: 'info',
                        html:
                        'We have sent you a <b>mail</b>, ' +
                        'for you account activation!',
                        showCloseButton: true,
                        showCancelButton: true,
                        focusConfirm: false,
                        confirmButtonText:
                        '<i class=fa fa-thumbs-up></i> Great!',
                        confirmButtonAriaLabel: 'Thumbs up, great!'
                      })
                      setTimeout(function() { window.location.replace('login.php'); } ,3500);
                    </script>";
                }
                else 
                {
                echo "<font color=red>Fail to send email!</font>";
                }
    }
}
else 
{
    echo "<font color=red>Fail to register your account!</font>";
}

?>